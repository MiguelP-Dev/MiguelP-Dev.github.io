<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goroutines | Miguel's Programing Notes</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
    <div class="app">
        <nav class="navbar">
    <div class="nav-container">
        <a href="/" class="nav-brand">
            Miguel's Programming Notes
        </a>

        <div class="nav-sections">
            
                
                
                
                <a href="/paquetes/"
                    class="nav-section "
                    data-section="paquetes">
                    üì¶ Paquetes
                </a>
            
                
                
                
                <a href="/ejemplos/"
                    class="nav-section active"
                    data-section="ejemplos">
                    üß© Ejemplos
                </a>
            
        </div>
    </div>
</nav>
        
        <div class="container">
            <button class="menu-toggle" aria-label="Abrir men√∫">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <aside class="sidebar" id="dynamic-sidebar">
    <div class="sidebar-header">
        <h3 class="sidebar-title">Miguel's Programming Notes</h3>
    </div>
    
    <div class="sidebar-content">
        
            
        
            
                <h3 class="sidebar-title">üß© Ejemplos</h3>
                <nav class="sidebar-nav">
                    
                        <a href="/ejemplos/api-rest/"
                            class="sidebar-item "
                            data-item="api-rest">
                            API REST
                        </a>
                    
                        <a href="/ejemplos/concurrentes/"
                            class="sidebar-item "
                            data-item="concurrentes">
                            Concurrentes
                        </a>
                    
                        <a href="/ejemplos/tests/"
                            class="sidebar-item "
                            data-item="test-unitarios">
                            Test Unitarios
                        </a>
                    
                </nav>
            
        
    </div>
</aside>
            
            <main class="content">
                <h1 id="aprendiendo-goroutines">Aprendiendo Goroutines</h1>

<h2 id="1-introducci√≥n-a-goroutines">1 Introducci√≥n a Goroutines</h2>

<p><strong><code class="language-plaintext highlighter-rouge">1.1 Conceptos b√°sicos de Concurrencia y Paralelismo</code></strong></p>

<p>La concurrencia y el paralelismo son dos conceptos comunes en la programaci√≥n multi-hilos. Se utilizan para describir eventos o ejecuciones de programas que pueden ocurrir simult√°neamente.</p>

<p>Concurrencia se refiere a m√∫ltiples tareas que se procesan en el mismo marco de tiempo, pero solo una tarea se ejecuta en un momento dado. Las tareas cambian r√°pidamente entre s√≠, dando al usuario la ilusi√≥n de una ejecuci√≥n simult√°nea. La concurrencia es adecuada para procesadores de un solo n√∫cleo.</p>

<p>Paralelismo se refiere a m√∫ltiples tareas que se ejecutan verdaderamente simult√°neamente al mismo tiempo, lo cual requiere soporte de procesadores de varios n√∫cleos.</p>

<p>El lenguaje Go est√° dise√±ado con la concurrencia en mente como uno de sus objetivos principales. Logra modelos eficientes de programaci√≥n concurrente a trav√©s de Goroutines y Canales. La ejecuci√≥n de las Goroutines es gestionada por el tiempo de ejecuci√≥n de Go, y puede planificar estas Goroutines en m√∫ltiples hilos del sistema para lograr un procesamiento paralelo.</p>

<p><strong><code class="language-plaintext highlighter-rouge">1.2 Goroutines en el lenguaje Go</code></strong></p>

<p>Las Goroutines son el concepto principal para lograr la programaci√≥n concurrente en el lenguaje Go. Son hilos livianos gestionados por el tiempo de ejecuci√≥n de Go. Desde la perspectiva del usuario, son similares a los hilos, pero consumen menos recursos y se inician m√°s r√°pidamente.</p>

<p><code class="language-plaintext highlighter-rouge">Las caracter√≠sticas de las Goroutines incluyen:</code></p>

<p><code class="language-plaintext highlighter-rouge">Livianas:</code> Las Goroutines ocupan menos memoria de pila en comparaci√≥n con los hilos tradicionales, y su tama√±o de pila puede expandirse o contraerse din√°micamente seg√∫n sea necesario.</p>

<p><code class="language-plaintext highlighter-rouge">Bajo costo operativo:</code> El costo operativo de crear y destruir Goroutines es mucho menor que el de los hilos tradicionales.</p>

<p><code class="language-plaintext highlighter-rouge">Mecanismo de comunicaci√≥n simple:</code> Los Canales proporcionan un mecanismo de comunicaci√≥n simple y efectivo entre las Goroutines.</p>

<p><code class="language-plaintext highlighter-rouge">Dise√±o no bloqueante:</code> Las Goroutines no bloquean a otras Goroutines para ejecutarse en ciertas operaciones. Por ejemplo, mientras una Goroutine est√° esperando operaciones de E/S, otras Goroutines pueden continuar ejecut√°ndose.</p>

<h2 id="2-creaci√≥n-y-gesti√≥n-de-goroutines">2 Creaci√≥n y Gesti√≥n de Goroutines</h2>

<p><strong><code class="language-plaintext highlighter-rouge">2.1 C√≥mo Crear una Goroutine</code></strong></p>

<p>En el lenguaje Go, puedes crear f√°cilmente una Goroutine usando la palabra clave go. Cuando precedes una llamada de funci√≥n con la palabra clave go, la funci√≥n se ejecutar√° de forma as√≠ncrona en una nueva Goroutine.</p>

<p><code class="language-plaintext highlighter-rouge">Veamos un ejemplo simple:</code></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"time"</span>
        <span class="p">)</span>

<span class="c">// Define una funci√≥n para imprimir Hola</span>
<span class="k">func</span> <span class="n">decirHola</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Hola"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c">// Inicia una nueva Goroutine usando la palabra clave go</span>
    <span class="k">go</span> <span class="n">decirHola</span><span class="p">()</span>

<span class="c">// La Goroutine principal espera un tiempo para permitir que decirHola se ejecute</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Funci√≥n principal"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>En el c√≥digo anterior, la funci√≥n <code class="language-plaintext highlighter-rouge">decirHola()</code> se ejecutar√° de forma as√≠ncrona en una nueva Goroutine. Esto significa que la funci√≥n <code class="language-plaintext highlighter-rouge">main()</code> no esperar√° a que termine <code class="language-plaintext highlighter-rouge">decirHola()</code> antes de continuar. Por lo tanto, usamos <code class="language-plaintext highlighter-rouge">time.Sleep</code> para pausar la Goroutine principal, permitiendo que se ejecute la instrucci√≥n de impresi√≥n en decirHola. Esto es solo con fines de demostraci√≥n. En el desarrollo real, t√≠picamente utilizamos canales u otros m√©todos de sincronizaci√≥n para coordinar la ejecuci√≥n de diferentes Goroutines.</p>

<p><strong>Nota:</strong> En aplicaciones pr√°cticas, no se debe usar <code class="language-plaintext highlighter-rouge">time.Sleep()</code> para esperar a que termine una Goroutine, ya que no es un mecanismo de sincronizaci√≥n confiable.</p>

<p><strong><code class="language-plaintext highlighter-rouge">2.2 Mecanismo de Programaci√≥n de Goroutines</code></strong></p>

<p>En Go, la programaci√≥n de las Goroutines es manejada por el planificador del tiempo de ejecuci√≥n de Go, que es responsable de asignar tiempo de ejecuci√≥n en los procesadores l√≥gicos disponibles. El planificador de Go utiliza la tecnolog√≠a de programaci√≥n M:N (m√∫ltiples Goroutines asignadas a m√∫ltiples hilos del sistema operativo) para lograr un mejor rendimiento en procesadores de varios n√∫cleos.</p>

<p><strong>GOMAXPROCS y Procesadores L√≥gicos:</strong>
<code class="language-plaintext highlighter-rouge">GOMAXPROCS</code> es una variable de entorno que define el n√∫mero m√°ximo de CPU disponibles para el planificador de tiempo de ejecuci√≥n, con el valor predeterminado siendo el n√∫mero de n√∫cleos de CPU en la m√°quina. El tiempo de ejecuci√≥n de Go asigna un hilo del sistema operativo para cada procesador l√≥gico. Al establecer <code class="language-plaintext highlighter-rouge">GOMAXPROCS</code>, podemos restringir el n√∫mero de n√∫cleos utilizados por el tiempo de ejecuci√≥n.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"runtime"</span>

<span class="k">func</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>El c√≥digo anterior establece un m√°ximo de dos n√∫cleos para programar las Goroutines, incluso al ejecutar el programa en una m√°quina con m√°s n√∫cleos.</p>

<p><strong>Operaci√≥n del Programador</strong>
El programador funciona utilizando tres entidades importantes: M (m√°quina), P (procesador) y G (Goroutine). M representa una m√°quina o hilo, P representa el contexto de planificaci√≥n y G representa una Goroutine espec√≠fica.</p>

<p><strong>M:</strong> Representa una m√°quina o hilo, sirviendo como una abstracci√≥n de los hilos del kernel del sistema operativo.</p>

<p><strong>P:</strong> Representa los recursos necesarios para ejecutar una Goroutine. Cada P tiene una cola local de Goroutines.</p>

<p><strong>G:</strong> Representa una Goroutine, incluyendo su pila de ejecuci√≥n, conjunto de instrucciones y otra informaci√≥n.
Los principios de funcionamiento del programador de Go son:</p>

<p>M debe tener un P para ejecutar G. Si no hay un P, M ser√° devuelto a la memoria cach√© del hilo.</p>

<p>Cuando G no est√° bloqueada por otras G (por ejemplo, en llamadas al sistema), se ejecuta en el mismo M tanto como sea posible, lo que ayuda a mantener los datos locales de G ‚Äúcalientes‚Äù para una utilizaci√≥n m√°s eficiente de la cach√© de la CPU.</p>

<p>Cuando un G est√° bloqueada, M y P se separar√°n, y P buscar√° un nuevo M o despertar√° un nuevo M para atender a otros G.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Hola desde Goroutine"</span><span class="p">)</span>
<span class="p">}()</span>
</code></pre></div></div>

<p>El c√≥digo anterior demuestra c√≥mo iniciar una nueva Goroutine, lo que llevar√° al programador a agregar esta nueva G a la cola para su ejecuci√≥n.</p>

<p><strong>Programaci√≥n Preventiva de Goroutines:</strong>
En las etapas iniciales, Go usaba programaci√≥n cooperativa, lo que significa que las Goroutines pod√≠an dejar sin recursos a otras Goroutines si se ejecutaban durante mucho tiempo sin ceder el control voluntariamente. Ahora, el programador de Go implementa programaci√≥n preventiva, permitiendo pausar las G largas para darle la oportunidad a otras G de ejecutarse.</p>

<p><strong><code class="language-plaintext highlighter-rouge">2.3 Gesti√≥n del Ciclo de Vida de Goroutines</code></strong></p>

<p>Para garantizar la robustez y el rendimiento de tu aplicaci√≥n Go, es crucial comprender y gestionar adecuadamente el ciclo de vida de las Goroutines. Iniciar Goroutines es sencillo, pero sin una gesti√≥n adecuada, pueden provocar problemas como fugas de memoria y condiciones de carrera.</p>

<p><strong>Iniciar Goroutines de forma segura:</strong>
Antes de iniciar una Goroutine, aseg√∫rate de comprender su carga de trabajo y caracter√≠sticas en tiempo de ejecuci√≥n. Una Goroutine debe tener un inicio y fin claros para evitar crear ‚Äúhu√©rfanos de Goroutines‚Äù sin condiciones de terminaci√≥n.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">worker</span><span class="p">(</span><span class="n">done</span> <span class="k">chan</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Trabajando..."</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span> <span class="c">// simular tarea costosa</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"¬°Trabajo terminado!"</span><span class="p">)</span>
    <span class="n">done</span> <span class="o">&lt;-</span> <span class="no">true</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c">// Aqu√≠ se utiliza el mecanismo de canales en Go. Simplemente piensa en el canal como una cola de mensajes b√°sica y utiliza el operador "&lt;-" para leer y escribir datos en la cola.</span>
    <span class="n">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">worker</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
    
    <span class="c">// Espera a que la Goroutine termine</span>
    <span class="o">&lt;-</span><span class="n">done</span>
<span class="p">}</span>
</code></pre></div></div>

<p>El c√≥digo anterior muestra una forma de esperar a que una Goroutine termine utilizando el canal done.</p>

<p><strong>Nota:</strong> Este ejemplo utiliza el mecanismo de canales en Go, que se detallar√° en cap√≠tulos posteriores.</p>

<p>Detener Goroutines
En general, el final del programa impl√≠citamente terminar√° todas las Goroutines. Sin embargo, en servicios de larga duraci√≥n, es posible que necesitemos detener activamente las Goroutines.</p>

<p>Usar canales para enviar se√±ales de detenci√≥n: Las Goroutines pueden sondear los canales para verificar se√±ales de detenci√≥n.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stop</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="k">struct</span><span class="p">{})</span>

<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="n">stop</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Se recibi√≥ la se√±al de detenci√≥n. Apagando..."</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="c">// ejecutar operaci√≥n normal</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}()</span>

<span class="c">// Enviar se√±al de detenci√≥n</span>
<span class="n">stop</span> <span class="o">&lt;-</span> <span class="k">struct</span><span class="p">{}{}</span>

<span class="c">// Usar el paquete context para gestionar el ciclo de vida:</span>
<span class="n">ctx</span><span class="p">,</span> <span class="n">cancel</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">WithCancel</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">())</span>

<span class="k">go</span> <span class="k">func</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="n">ctx</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Se recibi√≥ la se√±al de detenci√≥n. Apagando..."</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="c">// ejecutar operaci√≥n normal</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}(</span><span class="n">ctx</span><span class="p">)</span>

<span class="c">// cuando desees detener la Goroutine</span>
<span class="n">cancel</span><span class="p">()</span>
</code></pre></div></div>

<p>El uso del paquete <strong><code class="language-plaintext highlighter-rouge">context</code></strong> permite un control m√°s flexible de las Goroutines, proporcionando capacidades de tiempo de espera y cancelaci√≥n. En aplicaciones grandes o microservicios, <strong><code class="language-plaintext highlighter-rouge">context</code></strong> es la forma recomendada de controlar los ciclos de vida de las Goroutines.</p>

            </main>
        </div>
        
        <!-- Componente flotante de GitHub -->
<div class="github-floating">
    <a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="github-link" title="Ver en GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
    </a>
    
    
    <a href="https://github.com//MiguelP-Dev.github.io/blob/main/_pages/ejemplos/concurrentes/goroutines.md" target="_blank" rel="noopener noreferrer" class="edit-link" title="Editar esta p√°gina">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
        </svg>
    </a>
    
</div>

<style>
    /* Estilos del componente SVG */
    .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out;
    }
    
    @keyframes octocat-wave {
        0%, 100% { transform: rotate(0); }
        20%, 60% { transform: rotate(-25deg); }
        40%, 80% { transform: rotate(10deg); }
    }
    
    @media (max-width: 500px) {
        .github-corner:hover .octo-arm {
            animation: none;
        }
        .github-corner .octo-arm {
            animation: octocat-wave 560ms ease-in-out;
        }
    }
</style>
    </div>
    
    <script src="/assets/js/scripts.js"></script>
</body>
</html>